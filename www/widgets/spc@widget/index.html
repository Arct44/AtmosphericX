<!DOCTYPE html>
<html>
    <title>AtmosphericX - Alert Box</title>
    <link rel="icon" href="/assets/media/dashboard/favicon.ico" type="image/x-icon">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
    <link rel="stylesheet" href="../widgets/spc@widget/index.css">
    <link rel="stylesheet" href="../../assets/styles/streaming.css">
    <script src="../../assets/javascript/library.js"></script>
    <script src="../../assets/javascript/widgets.js"></script>
    <body> 
        <img src="https://www.spc.noaa.gov/products/outlook/day1otlk.gif" class="spc-image" id="spc-image">
        <div class="text">Day 1 Categorial Risk</div>
    </body>
    <script>
        /*
            SPC Days 1-3 widget, will auto rotate with text in the bottom right of the image....


            Calls:
            - library.createSession() - Creates a session and triggers a callback to get the configurations for the client from the server
            - library.init() - Initializes the library and sets the session to ready
            - library.sync() - Syncs the client with the server
        */
        library.createSession().then(() => {
            library.init()
            widgets.functions.init()
            let index = 0
            setInterval(async () => {
                let session = await library.checkSession()
                if (session) { 
                    await library.sync()
                }
            }, 200) 
            setInterval(() => {
                index++
                let risks = cache.config['spc:outlooks']
                risks.sort((a, b) => a.day - b.day)
                index = index >= risks.length ? 0 : index
                let risk = risks[index]
                document.getElementById('spc-image').src = risk.source
                document.querySelector('.text').innerText = risk.title
            }, 3000)
        })
    </script>
</html>