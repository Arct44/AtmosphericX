<!DOCTYPE html>
<html>
    <head>
        <style>
            body {
                margin: 0;
                padding: 0;
                font-family: sans-serif;
                background-color: #000000;
                color: rgb(0, 0, 0);
                overflow: hidden;
            }
            #uialert {
                font-size: 21px;
                width: 500px;
                overflow: hidden;
                color: white;
                text-align: left;
            }
        </style>
    </head>
    <body>
        <table id="uialert">
            <tr>
                <th>Type</th>
                <th>Location</th>
                <th>Expires</th>
            </tr>
        </table> 
    </body>
    <script>
        const home_ip_and_port = window.location.protocol + "//" + window.location.host;
        let list = []
        /**
         * Abreveate the event name.
         * @param {string} event - The event name.
         * @returns {string} - The abreviated event name.
        */
        function abreveate_event(event) {
            switch (event) {
                case `Tornado Emergency`:
                    return `TORE`;
                case `PDS`:
                    return `TORP`;
                case `Confirmed Tornado Warning`:
                    return `TORR`;
                case `Tornado Warning`:
                    return `TOR`;
                case `Radar Indicated Tornado Warning`:
                    return `TOR`;
                case `Destructive Severe Thunderstorm Warning`:
                    return `SVRD`;
                case `Considerable Destructive Severe Thunderstorm Warning`:
                    return `SVRC`;
                case `Severe Thunderstorm Warning`:
                    return `SVR`;
                case `Flash Flood Warning`:
                    return `FFW`;
                case `Special Marine Warning`:
                    return `SMW`;
                case `Snow Squall Warning`:
                    return `SQW`;
                default:
                    return event;
            }
        }
        /**
         * Request active alerts from the server.
         * @param {NULL} - No parameters.
         * @returns {NULL} - No returns.
        */
        async function request_active_alerts() {
            await fetch(`${home_ip_and_port}/api/alerts`).then(response => response.text()).then(data => {
                let jsonData = JSON.parse(data)
                if (jsonData == undefined || jsonData.length == 0) { return }
                for (let i = 0; i < jsonData.length; i++) {
                    let alert = jsonData[i]
                    list.push(alert)
                }
            })
            list.sort((a, b) => {
                if (a.eventName == `Tornado Emergency`) {return -1}
                if (b.eventName == `Tornado Emergency`) {return 1}
                if (a.eventName == `PDS`) {return -1}
                if (b.eventName == `PDS`) {return 1}
                if (a.eventName == `Confirmed Tornado Warning`) {return -1}
                if (b.eventName == `Confirmed Tornado Warning`) {return 1}
                if (a.eventName == `Tornado Warning`) {return -1}
                if (b.eventName == `Tornado Warning`) {return 1}
                if (a.eventName == `Radar Indicated Tornado Warning`) {return -1}
                if (b.eventName == `Radar Indicated Tornado Warning`) {return 1}
                if (a.eventName == `Destructive Severe Thunderstorm Warning`) {return -1}
                if (b.eventName == `Destructive Severe Thunderstorm Warning`) {return 1}
                if (a.eventName == `Considerable Destructive Severe Thunderstorm Warning`) {return -1}
                if (b.eventName == `Considerable Destructive Severe Thunderstorm Warning`) {return 1}
                if (a.eventName == `Severe Thunderstorm Warning`) {return -1}
                if (b.eventName == `Severe Thunderstorm Warning`) {return 1}
                if (a.eventName == `Flash Flood Warning`) {return -1}
                if (b.eventName == `Flash Flood Warning`) {return 1}
                if (a.eventName == `Special Marine Warning`) {return -1}
            }) 
            list.reverse() // Reverse them because we have them in the wrong order (hehehehe)
            document.getElementById("uialert").innerHTML = `<tr><th>Type</th><th>Location</th><th>Expires</th></tr>`
            for (let i = 0; i < list.length; i++) {
                let alert = list[i]
                let tmp = abreveate_event(alert.eventName)
                console.log(tmp)
                if (tmp == alert.eventName) {continue}
                let table = document.getElementById("uialert")
                let row = table.insertRow(-1)
                let cell1 = row.insertCell(0)
                let cell2 = row.insertCell(1)
                let cell3 = row.insertCell(2)
                cell1.innerHTML = abreveate_event(alert.eventName)
                cell2.innerHTML = alert.locations.substring(0, 10);
                cell3.innerHTML = alert.expires
            }
        }
        /**
         * Interval and Initital request to the server.
         * @param {NULL} - No parameters.
         * @returns {NULL} - No returns.
        */
        setInterval(function () {
            list = []
            request_active_alerts()
        }, 8000);
        request_active_alerts()
    </script>
</html>
